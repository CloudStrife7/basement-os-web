---
import '../styles/global.css';
import '../styles/shutdown.css';
import { ClientRouter } from 'astro:transitions';
import SEO from '../components/SEO.astro';

interface Props {
	title: string;
	description?: string;
    image?: string;
    article?: boolean;
    audience?: 'player' | 'dev';
    noIndex?: boolean;
}

const { title, description, image, article, audience, noIndex } = Astro.props;
---

<!DOCTYPE html>
<html lang="en" data-theme="synthwave">
	<head>
        <SEO 
            title={title} 
            description={description} 
            image={image} 
            article={article} 
            audience={audience} 
            noIndex={noIndex} 
        />
		<ClientRouter />
        <script is:inline>
            // Disable browser's scroll restoration to prevent progress bar on scroll
            // Astro's ClientRouter calls history.replaceState during scroll which
            // triggers native mobile browser progress indicators
            if ('scrollRestoration' in history) {
                history.scrollRestoration = 'manual';
            }
        </script>
        <script is:inline>
            // Immediately invoked function to set the theme and mode before FOUC
            (function() {
                try {
                    var savedTheme = localStorage.getItem('basement-os-theme') || 'synthwave';
                    document.documentElement.setAttribute('data-theme', savedTheme);
                    
                    var savedMode = localStorage.getItem('basement-os-mode') || 'both';
                    document.documentElement.classList.add('mode-' + savedMode);
                } catch (e) {
                    console.error('System initialization failed', e);
                }
            })();
        </script>
	</head>
	<body>
		<slot />
	</body>
</html>
