markdown# PROJECT_KNOWLEDGE.md

# Lower Level 2.0 – Project Knowledge
*(A single, self-contained reference for every team member and AI assistant.)*

## Table of Contents
1. [Project Overview](#1-project-overview)
2. [System Architecture Diagram](#2-system-architecture-diagram)
3. [Core Components](#3-core-components)
   * [AchievementTracker](#achievementtracker)
   * [AchievementDataManager](#achievementdatamanager)
   * [NotificationEventHub](#notificationeventhub)
   * [Multi-TV Broadcasting Pattern](#multi-tv-broadcasting-pattern)
   * [DOSTerminalAchievementModule](#dostermalachievementmodule)
4. [Key Design Decisions](#4-key-design-decisions)
5. [Implementation Steps](#5-implementation-steps)
6. [Performance & Resource Considerations](#6-performance--resource-considerations)
7. [Testing & Rollback Plan](#7-testing--rollback-plan)
8. [Future Enhancements & Roadmap](#8-future-enhancements--roadmap)
9. [File & Folder Structure](#9-file--folder-structure)

## 1. Project Overview

Lower Level 2.0 is a deeply personal VRChat world recreating a nostalgic 2000s basement environment. The project focuses on creating an authentic social hangout that celebrates community through Xbox Live-style achievement notifications, player progression tracking, and retro computing aesthetics. The goal is to encourage repeat visits and build a sense of belonging through gamification while maintaining the authentic basement atmosphere.

The notification and achievement system targets both PC VR/Desktop (90fps) and Quest (72fps) platforms, with Android/iOS as secondary priorities. The architecture emphasizes modularity, allowing independent development of features like the Nokia Snake game and AI Cat companion while protecting the core notification system that took 11+ hours to debug and perfect.

All systems communicate through UdonSharp-compatible patterns using SendCustomEvent and frame-based delays, avoiding unreliable time-based methods. The project maintains strict backwards compatibility, ensuring that working systems are never modified directly but rather extended through new connection layers.

## 2. System Architecture Diagram
┌─────────────────────────────────────────────────────────────────────────┐
│                          VRChat Network Events                          │
│                         OnPlayerJoined / OnPlayerLeft                   │
└────────────────────────────────┬───────────────────────────────────────┘
│
▼
┌─────────────────────────────────────────────────────────────────────────┐
│                        AchievementTracker.cs                            │
│  - Detects player joins                                                 │
│  - Updates visit counts via AchievementDataManager                     │
│  - Detects new achievement unlocks                                     │
│  - Sets eventPlayerName & eventAchievementLevel                        │
│  - Calls NotificationEventHub.SendCustomEvent()                        │
└────────────────┬──────────────────────────────┬────────────────────────┘
│                              │
▼                              ▼
┌─────────────────────────────┐    ┌────────────────────────────────────┐
│  AchievementDataManager.cs  │    │    NotificationEventHub.cs         │
│  - Stores player visit data │◄───│  - Reads event parameters          │
│  - Tracks milestones        │    │  - Determines notification type    │
│  - Provides point totals    │    │  - Manages user status (S/P/R)    │
│  - VRChat persistence       │    │  - Broadcasts to all displays     │
└─────────────────────────────┘    └────────────┬───────────────────────┘
▲                              │
│                              ▼
│         ┌─────────────────────────────────────┐
│         │        Multi-TV Broadcasting        │
│         ├─────────────────────────────────────┤
│         │ TV1: XboxNotificationUI (Main)      │
│         │ TV2: XboxNotificationUI (Lounge)    │
│         │ TV3: XboxNotificationUI (Arcade)    │
│         └─────────────────────────────────────┘
│                              │
│                              ▼
│         ┌─────────────────────────────────────┐
└─────────┤  DOSTerminalAchievementModule.cs   │
│  - Queries live achievement data    │
│  - Updates terminal pages           │
│  - Shows leaderboard & tiers       │
└─────────────────────────────────────┘

## 3. Core Components

### AchievementTracker

**Responsibilities:**
* Detect VRChat OnPlayerJoined events
* Increment player visit counts through DataManager
* Check if players earned new achievements on current visit
* Trigger NotificationEventHub when achievements unlock
* Provide manual testing methods for development

**Public Interface:**
```csharp
public override void OnPlayerJoined(VRCPlayerApi player)
public override void OnPlayerLeft(VRCPlayerApi player)
public void SimulatePlayerJoin(string testPlayerName)
public string GetTrackerStatus()
[HideInInspector] public string eventPlayerName = "";
[HideInInspector] public int eventAchievementLevel = -1;
Dependencies:

Reads: VRChat player events
Writes: AchievementDataManager (visit counts)
Notifies: NotificationEventHub (achievement unlocks)

Configurable Fields:

dataManager - Reference to AchievementDataManager
notificationEventHub - Reference to event hub (optional)
enableDebugLogging - Toggle console output
checkAchievementsOnJoin - Enable achievement detection

Code Snippet:
csharp// Minimal modification to connect to NotificationEventHub
if (notificationEventHub != null)
{
    eventPlayerName = playerName;
    eventAchievementLevel = achievementLevel;
    notificationEventHub.SendCustomEvent("OnAchievementEarned");
}
AchievementDataManager
Responsibilities:

Store player visit data using VRChat persistence
Track 8 achievement milestones (1, 5, 10, 25, 50, 75, 100, 250 visits)
Calculate total achievement points per player
Provide achievement titles and point values
Handle data serialization/deserialization

Public Interface:
csharppublic int GetPlayerVisits(string playerName)
public int AddPlayerVisit(string playerName)
public bool HasPlayerEarnedAchievement(string playerName, int achievementLevel)
public string GetAchievementTitle(int achievementLevel)
public int GetAchievementPoints(int achievementLevel)
public int GetPlayerTotalPoints(string playerName)
public string[] GetAllPlayerNames()
Dependencies:

Uses: VRChat persistence system
Provides data to: AchievementTracker, NotificationEventHub, DOSTerminal

Configurable Fields:

enableDebugLogging - Debug output toggle
maxPlayersToTrack - Limit for memory management (default: 1000)

Code Snippet:
csharp// Core achievement milestone configuration
private int[] achievementMilestones = { 1, 5, 10, 25, 50, 75, 100, 250 };
private string[] achievementTitles = {
    "First Time Visitor", "Regular Visitor", "Frequent Flyer",
    "Basement Dwellers", "Lower Level Legends", "Founding Members",
    "Century Club", "Legendary Status"
};
private int[] achievementPoints = { 10, 15, 25, 50, 75, 100, 150, 250 };
NotificationEventHub
Responsibilities:

Bridge between achievement detection and notification displays
Determine user status (Regular/Supporter/Pwnerer)
Broadcast notifications to multiple TV displays
Queue appropriate notification types based on context
Update DOS terminal when achievements change

Public Interface:
csharppublic void OnAchievementEarned() // Reads from AchievementTracker variables
public void OnPlayerJoinedWorld() // Reads from AchievementTracker variables
public void OnExtendedAchievementEarned() // For time/social achievements
public void UpdateDOSTerminalDelayed()
Dependencies:

Reads: AchievementTracker (event parameters)
Reads: AchievementDataManager (player data)
Writes: XboxNotificationUI instances (queues notifications)
Notifies: DOSTerminalAchievementModule (data updates)

Configurable Fields:

achievementTracker - Source of achievement events
dataManager - Player data source
primaryNotificationDisplay - Main TV display
additionalDisplays[] - Extra TV displays
supporterUsernames[] - VIP player list
pwnererUsernames[] - Owner list

Code Snippet:
csharp// Broadcast to all displays
for (int i = 0; i < allDisplays.Length; i++)
{
    if (allDisplays[i] == null) continue;
    allDisplays[i].QueueAchievementNotification(playerName, achievementTitle, points);
}
Multi-TV Broadcasting Pattern
Responsibilities:

Maintain synchronized notifications across 3 TV displays
Each TV manages its own queue and animation timing
Support different TV technologies (standard Canvas, ProTV prefab)
Handle TV-specific positioning and scaling

Public Interface:

Each TV has identical XboxNotificationUI interface
NotificationEventHub broadcasts to all TVs simultaneously
No inter-TV communication required

Dependencies:

Each TV independently processes its notification queue
All TVs receive identical commands from NotificationEventHub

Configurable Fields:

Per-TV positioning via Transform
Per-TV Canvas settings for ProTV compatibility
Individual queue size limits

Code Snippet:
csharp// Single command broadcasts to all displays
notificationHub.QueueNotificationOnAllDisplays(type, player, title, points);
    → TV1.QueueAchievementNotification(player, title, points)
    → TV2.QueueAchievementNotification(player, title, points)  
    → TV3.QueueAchievementNotification(player, title, points)
DOSTerminalAchievementModule
Responsibilities:

Query live achievement data from DataManager
Generate formatted terminal pages for each achievement tier
Create leaderboard showing top players by points
Update terminal content periodically
Only show achievement pages after someone earns them

Public Interface:
csharppublic void RefreshAchievementData()
public void UpdateAllAchievementPages()
public string GetAchievementPage(int pageIndex)
Dependencies:

Reads: AchievementDataManager (all player data)
Provides: Formatted text pages to DOS terminal

Configurable Fields:

dataManager - Achievement data source
playersPerPage - Display limit per page
updateIntervalSeconds - Refresh frequency

Code Snippet:
csharp// Community-unlocked pages
if (!HasAnyoneEarnedTier(allPlayers, tier)) continue;

// Format for DOS display
pageText += $"   LOWER LEVEL HALL OF FAME - {milestones[tier]} VISITS\n";
pageText += $"              {titles[tier].ToUpper()}\n";
4. Key Design Decisions

Preservation of Working Code - XboxNotificationUI remains completely unchanged after 11+ hours of debugging
Modular Component Design - Each system can operate independently, connected through optional references
Event-Driven Architecture - No continuous Update() loops except for UI animations
Single Queue, Multiple Displays - One NotificationEventHub broadcasts to N displays
UdonSharp Compatibility First - Use proven patterns: SendCustomEventDelayedFrames, GetProgramVariable for parameters
Frame-Based Over Time-Based - SendCustomEventDelayedFrames instead of unreliable Seconds variant
Explicit References Over Discovery - Components connected via Inspector, not FindObjectOfType
Community-Unlocked Content - Achievement pages only appear after someone earns them

5. Implementation Steps

Create NotificationEventHub GameObject

Add empty GameObject named "NotificationEventHub"
Add NotificationEventHub.cs component
Leave all references empty initially


Connect DataManager and Tracker References

Assign AchievementSystem to both dataManager and achievementTracker fields
Test in Play mode - verify no errors


Add Primary Notification Display

Assign H3Title (with XboxNotificationUI) to primaryNotificationDisplay
Test with context menu "Test Regular Achievement"


Modify AchievementTracker (Minimal Changes)
csharp// Add fields:
[SerializeField] private UdonBehaviour notificationEventHub;
[HideInInspector] public string eventPlayerName = "";
[HideInInspector] public int eventAchievementLevel = -1;

// Add to OnPlayerJoined and HandleNewAchievement

Connect Hub to Tracker

In AchievementTracker Inspector, assign NotificationEventHub
Test: Enter Play mode, should see "First Time Visitor" notification


Setup Multi-TV Displays

Duplicate H3Title twice (H3Title_TV2, H3Title_TV3)
Position in different world locations
Add to additionalDisplays array in NotificationEventHub


(Optional) Add DOS Terminal Module

Add DOSTerminalAchievementModule to DOS terminal GameObject
Connect dataManager reference
Terminal auto-updates with real achievement data



6. Performance & Resource Considerations
Network Traffic:

BehaviourSyncMode.None on notification components (local-only)
Achievement data uses VRChat persistence (network-efficient)
No continuous network updates

Update Frequency:

Achievement checks: Only on OnPlayerJoined
DOS Terminal: Configurable 30-second refresh
Notifications: 4-second display duration
Icon pulsing: 0.5-second intervals during display only

Memory Usage:

Player tracking: ~1KB per 100 players
Notification queue: 10 items max per display (2KB)
DOS Terminal text: ~10KB for all pages
Total system: <5MB with 1000 players

Quest Optimization:

72fps target maintained
15-20 total draw calls for 3 TVs
Simple UI shaders only
CanvasGroup.alpha for fading (GPU-optimized)

7. Testing & Rollback Plan
Before Integration Checklist:

 Full project backup created
 All systems work independently
 Inspector settings documented
 NotificationTestRunner confirms notifications work

During Integration Tests:

 Add NotificationEventHub with no references
 Connect references one at a time
 Test after each connection
 Use context menu tests before live testing

After Integration Validation:

 Real player join triggers notification
 All 3 TVs show synchronized notifications
 DOS terminal shows real achievement data
 No Console errors
 Performance remains smooth

Rollback Procedures:

Quick Fix: Set notificationEventHub to null in AchievementTracker
Component Rollback: Delete NotificationEventHub GameObject
Code Rollback: Comment out integration code in AchievementTracker
Full Rollback: Restore from backup

8. Future Enhancements & Roadmap
Phase 2 - Extended Achievements:

Time-based: Night Owl, Early Bird, Weekend Warrior
Social: Party Time (8+), Basement's 11 (11+), Full House (16+)
Activity: Snake Champion, Cat Whisperer, Marathon Session

Phase 3 - External Integrations:

Ko-fi supporter notifications via GitHub Pages
Remote text updates for DOS terminal changelog
Nokia Snake game via ILowerLevelIntegration interface
AI Cat with pet-tracking achievements

API Hooks Available:

ReportActivityAchievement() for external games
OnExtendedAchievementEarned() for special achievements
Custom notification types via NotificationType enum
DOS terminal page registration system

Analytics Dashboard (Future):

Player retention metrics
Achievement completion rates
Popular visit times heatmap
Instance population trends

9. File & Folder Structure
/ProjectRoot
├─ PROJECT_KNOWLEDGE.md              # This master document
├─ /Assets
│  ├─ /Scripts
│  │  ├─ /LowerLevel
│  │  │  ├─ /Achievements
│  │  │  │  ├─ AchievementTracker.cs
│  │  │  │  ├─ AchievementDataManager.cs
│  │  │  │  └─ ExtendedAchievementTracker.cs
│  │  │  ├─ /Integration
│  │  │  │  ├─ NotificationEventHub.cs
│  │  │  │  ├─ ILowerLevelIntegration.cs
│  │  │  │  └─ MockLowerLevelIntegration.cs
│  │  │  ├─ /Notifications
│  │  │  │  └─ XboxNotificationUI.cs
│  │  │  └─ /Terminal
│  │  │     ├─ DOSTerminalController.cs
│  │  │     └─ DOSTerminalAchievementModule.cs
│  │  └─ /Testing
│  │     ├─ NotificationTestRunner.cs
│  │     └─ SetupVerifier.cs
│  └─ /Prefabs
│     ├─ AchievementSystem.prefab
│     ├─ NotificationDisplay.prefab
│     └─ DOSTerminal.prefab
├─ /docs
│  ├─ /components
│  │  ├─ AchievementSystem.md
│  │  ├─ NotificationSystem.md
│  │  └─ IntegrationGuide.md
│  └─ /diagrams
│     └─ SystemArchitecture.svg
└─ README.md