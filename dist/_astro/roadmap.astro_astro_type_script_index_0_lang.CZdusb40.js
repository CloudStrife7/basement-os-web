function _(){if(window.__roadmapInitialized)return;window.__roadmapInitialized=!0;const w="/data/roadmap.json";function $(e){const t=e.map(s=>typeof s=="string"?s:s.name);return t.includes("priority: critical")?"critical":t.includes("priority: high")?"high":t.includes("priority: medium")?"medium":"low"}function M(e){if(typeof e=="object"&&e.color)return`#${e.color}`;const t=typeof e=="string"?e:e.name;return t==="bug"?"#ff4444":t==="enhancement"?"#44aa44":t==="documentation"?"#0066cc":t.startsWith("area:")?"#6666ff":t.startsWith("priority:")?"#ffaa00":t==="concept"?"#aa66cc":t==="maintenance"?"#888888":t==="needs-testing"?"#ff8800":"#666666"}function I(e){return e.filter(t=>!(typeof t=="string"?t:t.name).startsWith("priority:")).slice(0,4)}function C(e){return e.replace(/^\[.*?\]\s*/,"")}function y(e,t=!1){const s=e.labels||[],p=$(s),d=I(s),a=document.createElement("div");a.className=`issue-card ${t?"completed":`priority-${p}`}`;const f=d.map(r=>{const u=typeof r=="string"?r:r.name,c=M(r),m=H(c)?"#000":"#fff";return`<span class="issue-label" style="background: ${c}; color: ${m}">${u.replace("area: ","")}</span>`}).join(""),g=e.milestone?`<div class="issue-milestone">${e.milestone}</div>`:"";return a.innerHTML=`
            <div class="issue-card-header">
                <span class="issue-title">${C(e.title)}</span>
                <span class="issue-number">#${e.number}</span>
            </div>
            <div class="issue-card-details">
                ${f?`<div class="issue-labels">${f}</div>`:""}
                ${g}
            </div>
        `,a}function H(e){const t=e.replace("#",""),s=parseInt(t.substr(0,2),16),p=parseInt(t.substr(2,2),16),d=parseInt(t.substr(4,2),16);return(s*299+p*587+d*114)/1e3>155}function T(e){const t=e.open_issues+e.closed_issues>0?Math.round(e.closed_issues/(e.open_issues+e.closed_issues)*100):0,s=document.createElement("div");return s.className="milestone-card",s.innerHTML=`
            <div class="milestone-title">${e.title}</div>
            <div class="milestone-progress">
                <div class="milestone-progress-bar" style="width: ${t}%"></div>
            </div>
            <div class="milestone-stats">
                <span>${e.closed_issues} done</span>
                <span>${e.open_issues} remaining</span>
                <span>${t}%</span>
            </div>
        `,s}function k(e){const{issues:t,milestones:s,closed:p}=e,d=t.filter(n=>{const l=(n.labels||[]).map(o=>typeof o=="string"?o:o.name);return l.includes("priority: critical")||l.includes("priority: high")}),a=t.filter(n=>(n.labels||[]).map(o=>typeof o=="string"?o:o.name).includes("priority: medium")),f=t.filter(n=>{const i=n.labels||[],l=i.map(L=>typeof L=="string"?L:L.name);return $(i)==="low"||!l.includes("priority: critical")&&!l.includes("priority: high")&&!l.includes("priority: medium")}),g=new Date;g.setDate(g.getDate()-30);const r=p.filter(n=>n.closed_at&&new Date(n.closed_at)>g),u=document.getElementById("current-focus");u&&(u.innerHTML="",d.length===0?u.innerHTML='<div class="empty-state">No high-priority items right now</div>':d.forEach(n=>u.appendChild(y(n))));const c=document.getElementById("milestones");if(c){c.innerHTML="";const n=s.filter(i=>i.state==="open");n.length===0?c.innerHTML='<div class="empty-state">No active milestones</div>':n.forEach(i=>c.appendChild(T(i)))}const m=document.getElementById("coming-soon");m&&(m.innerHTML="",a.length===0?m.innerHTML='<div class="empty-state">No medium-priority items queued</div>':a.forEach(n=>m.appendChild(y(n))));const h=document.getElementById("backlog");h&&(h.innerHTML="",f.length===0?h.innerHTML='<div class="empty-state">Backlog is empty</div>':f.forEach(n=>h.appendChild(y(n))));const b=document.getElementById("completed");if(b&&(b.innerHTML="",r.length===0?b.innerHTML='<div class="empty-state">No issues closed in the last 30 days</div>':r.slice(0,10).forEach(n=>b.appendChild(y(n,!0)))),e.generated_at){const n=new Date(e.generated_at).toLocaleString();console.log(`Roadmap data last synced: ${n}`)}}const v=document.getElementById("toggle-backlog"),E=document.getElementById("backlog");v&&E&&v.addEventListener("click",()=>{E.classList.toggle("collapsed"),v.textContent=E.classList.contains("collapsed")?"Show All Backlog Items":"Collapse Backlog"}),fetch(w).then(e=>{if(!e.ok)throw new Error("Roadmap data not found");return e.json()}).then(e=>{k(e)}).catch(e=>{console.error("Failed to load roadmap:",e),document.querySelectorAll(".loading-indicator").forEach(t=>{t.textContent="Roadmap data not yet synced"})})}document.addEventListener("astro:before-swap",()=>{window.__roadmapInitialized=!1});document.addEventListener("astro:page-load",_);document.addEventListener("DOMContentLoaded",_);document.readyState!=="loading"&&_();
