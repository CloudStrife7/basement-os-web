```astro
---
import '../styles/global.css';
import '../styles/shutdown.css';
import { ClientRouter } from 'astro:transitions';
import SEO from '../components/SEO.astro';

interface Props {
	title: string;
	description?: string;
    image?: string;
    article?: boolean;
    audience?: 'player' | 'dev';
    noIndex?: boolean;
}

const { title, description, image, article, audience, noIndex } = Astro.props;
---

<!DOCTYPE html>
<html lang="en" data-theme="synthwave">
	<head>
        <SEO 
            title={title} 
            description={description} 
            image={image} 
            article={article} 
            audience={audience} 
            noIndex={noIndex} 
        />
		<ClientRouter />
        <script is:inline>
            // Disable browser's scroll restoration to prevent progress bar on scroll
            // Astro's ClientRouter calls history.replaceState during scroll which
            // triggers native mobile browser progress indicators
            if ('scrollRestoration' in history) {
                history.scrollRestoration = 'manual';
            }
        </script>
        <!-- Script temporarily removed for debugging -->
	</head>
	<body>
		<slot />
	</body>
</html>  <script>
  /**
   * â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
   * â”‚  GUNTER PROTOCOL - Glitch Effects Engine                    â”‚
   * â”‚  v2.0.0.5 (The 2005 release, obviously)                     â”‚
   * â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
   * 
   * Hidden Commands (for those who grep):
   * - Type "iddqd" anywhere: Nothing happens. This isn't DOOM.
   * - Type "konami": Also nothing. But we appreciate the attempt.
   * - Type "xyzzy": A hollow voice says "Plugh."
   * 
   * Secret: The ğŸ¢ at the bottom isn't random.
   * "Slow and steady wins the race" - but also:
   * "Turtle" -> "Tuttle" -> Brazil (1985) -> bureaucratic dystopia
   * -> The absurdity of hunting eggs in a simulation within a game
   *     documented on a website you're reading right now.
   * 
   * Or it's just a cute turtle. You decide.
   * 
   * P.S. - The weather in Lower Level is real. Check Fond du Lac.
   *        When it rains there, it rains in the basement.
   */

  (function() {
    'use strict';

    // ==========================================
    // Configuration
    // ==========================================
    const CONFIG = {
      // Matrix rain settings
      matrix: {
        fontSize: 14,
        fallSpeed: 0.5,        // Very slow
        density: 0.03,         // Sparse columns
        flickerChance: 0.001   // Rare white flicker
      },
      // Text glitch settings
      glitch: {
        chance: 0.005,         // 0.5% chance per character
        interval: [8000, 15000], // Every 8-15 seconds
        duration: 150,         // ms
        maxChars: 2            // Max simultaneous glitched chars
      },
      // Scan line settings
      scanLine: {
        interval: [45000, 90000] // Every 45-90 seconds
      },
      // Chromatic aberration
      chromatic: {
        scrollChance: 0.05     // 1 in 20 scrolls
      }
    };

    // Glitch characters pool
    const GLITCH_CHARS = 'Ì·Ì¸ÌµÌ¶Ì¢Ì¡Ì¨Ì›Í“Ì Ì£Ì¤Ì¥Ì¦Ì©ÌªÌ«Ì¬Ì­Ì®Ì¯Ì°Ì±Ì²Ì³Ì€ÌÌ‚ÌƒÌ„Ì…Ì†Ì‡ÌˆÌ‰ÌŠÌ‹ÌŒÌÌÌÌÌ‘Ì’Ì“Ì”Ì•ÌšÍ˜ÍœÍ¢ÍœÍŸÍ Í¡Í…@#$%^&*â–ˆâ–“â–’â–‘';

    // State
    let effectsEnabled = true;
    let animationFrameId = null;

    // ==========================================
    // Matrix Rain Effect
    // ==========================================
    function initMatrixRain() {
      const canvas = document.getElementById('matrix-rain');
      if (!canvas) return;

      const ctx = canvas.getContext('2d');
      
      function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
      }
      resize();
      window.addEventListener('resize', resize);

      const columns = [];
      const fontSize = CONFIG.matrix.fontSize;

      function initColumns() {
        const columnCount = Math.floor(canvas.width / fontSize);
        columns.length = 0;
        for (let i = 0; i < columnCount; i++) {
          // Random starting positions
          columns.push({
            y: Math.random() * canvas.height,
            speed: 0.3 + Math.random() * 0.4,
            active: Math.random() < CONFIG.matrix.density
          });
        }
      }
      initColumns();
      window.addEventListener('resize', initColumns);

      function draw() {
        if (!effectsEnabled) {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          animationFrameId = requestAnimationFrame(draw);
          return;
        }

        // Fade effect
        ctx.fillStyle = 'rgba(10, 10, 10, 0.05)';
        ctx.fillRect(0, 0, canvas.width, canvas.height);

        ctx.font = fontSize + 'px monospace';

        columns.forEach((col, i) => {
          if (!col.active) return;

          // Random binary character
          const char = Math.random() > 0.5 ? '0' : '1';
          
          // Rare white flicker
          if (Math.random() < CONFIG.matrix.flickerChance) {
            ctx.fillStyle = '#ffffff';
          } else {
            ctx.fillStyle = '#00ff00';
          }

          ctx.fillText(char, i * fontSize, col.y);

          // Reset or continue falling
          if (col.y > canvas.height && Math.random() > 0.99) {
            col.y = 0;
            col.active = Math.random() < CONFIG.matrix.density;
          } else {
            col.y += col.speed;
          }
        });

        animationFrameId = requestAnimationFrame(draw);
      }

      draw();
    }

    // ==========================================
    // Text Glitch Effect
    // ==========================================
    function initTextGlitch() {
      const glitchElements = document.querySelectorAll('[data-glitch="true"]');
      if (!glitchElements.length) return;

      function glitchText() {
        if (!effectsEnabled) {
          scheduleNextGlitch();
          return;
        }

        // Pick random element
        const el = glitchElements[Math.floor(Math.random() * glitchElements.length)];
        const text = el.textContent;
        const glitchCount = Math.floor(Math.random() * CONFIG.glitch.maxChars) + 1;

        // Find random positions to glitch
        const positions = [];
        for (let i = 0; i < glitchCount; i++) {
          const pos = Math.floor(Math.random() * text.length);
          if (text[pos] !== ' ' && Math.random() < CONFIG.glitch.chance * 100) {
            positions.push(pos);
          }
        }

        if (positions.length === 0) {
          scheduleNextGlitch();
          return;
        }

        // Apply glitch
        let glitchedText = text.split('');
        positions.forEach(pos => {
          const glitchChar = GLITCH_CHARS[Math.floor(Math.random() * GLITCH_CHARS.length)];
          glitchedText[pos] = glitchChar;
        });
        el.textContent = glitchedText.join('');

        // Restore after duration
        setTimeout(() => {
          el.textContent = text;
        }, CONFIG.glitch.duration);

        scheduleNextGlitch();
      }

      function scheduleNextGlitch() {
        const delay = CONFIG.glitch.interval[0] + 
          Math.random() * (CONFIG.glitch.interval[1] - CONFIG.glitch.interval[0]);
        setTimeout(glitchText, delay);
      }

      scheduleNextGlitch();
    }

    // ==========================================
    // Scan Line Effect
    // ==========================================
    function initScanLine() {
      const scanLine = document.getElementById('scan-line');
      if (!scanLine) return;

      function triggerScan() {
        if (!effectsEnabled) {
          scheduleNextScan();
          return;
        }

        scanLine.classList.add('active');
        setTimeout(() => {
          scanLine.classList.remove('active');
        }, 800);

        scheduleNextScan();
      }

      function scheduleNextScan() {
        const delay = CONFIG.scanLine.interval[0] + 
          Math.random() * (CONFIG.scanLine.interval[1] - CONFIG.scanLine.interval[0]);
        setTimeout(triggerScan, delay);
      }

      // Initial delay before first scan
      setTimeout(triggerScan, 10000);
    }

    // ==========================================
    // Chromatic Aberration on Scroll
    // ==========================================
    function initChromaticScroll() {
      let lastScrollY = window.scrollY;
      let scrollTimeout;

      window.addEventListener('scroll', () => {
        if (!effectsEnabled) return;

        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
          const scrollDelta = Math.abs(window.scrollY - lastScrollY);
          
          if (scrollDelta > 50 && Math.random() < CONFIG.chromatic.scrollChance) {
            document.body.classList.add('chromatic-shift');
            setTimeout(() => {
              document.body.classList.remove('chromatic-shift');
            }, 150);
          }
          
          lastScrollY = window.scrollY;
        }, 50);
      });
    }

    // ==========================================
    // Effects Toggle
    // ==========================================
    function initToggle() {
      const toggle = document.getElementById('effects-toggle');
      if (!toggle) return;

      toggle.addEventListener('click', () => {
        effectsEnabled = !effectsEnabled;
        toggle.classList.toggle('disabled', !effectsEnabled);
        
        // Update ARIA
        toggle.setAttribute('aria-pressed', effectsEnabled);
        
        // Store preference
        try {
          localStorage.setItem('gunter-effects', effectsEnabled ? 'on' : 'off');
        } catch (e) {}
      });

      // Check stored preference
      try {
        const stored = localStorage.getItem('gunter-effects');
        if (stored === 'off') {
          effectsEnabled = false;
          toggle.classList.add('disabled');
        }
      } catch (e) {}
    }

    // ==========================================
    // Initialize All Effects
    // ==========================================
    function init() {
      // Check for reduced motion preference
      if (window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
        effectsEnabled = false;
        const toggle = document.getElementById('effects-toggle');
        if (toggle) toggle.classList.add('disabled');
      }

      initToggle();
      initMatrixRain();
      initTextGlitch();
      initScanLine();
      initChromaticScroll();

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // Console Easter Eggs for the curious
      // "The devtools are the first dungeon." - The Codex
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      console.log('%cğŸ¢ GUNTER PROTOCOL ACTIVE', 
        'color: #00ff00; font-size: 20px; font-weight: bold; text-shadow: 0 0 10px #00ff00;');
      console.log('%c"The basement remembers. Do you?"', 
        'color: #508050; font-style: italic; font-size: 12px;');
      console.log('');
      console.log('%câ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”', 'color: #00aa00;');
      console.log('%câ”‚  You found the first layer.                 â”‚', 'color: #00aa00;');
      console.log('%câ”‚                                             â”‚', 'color: #00aa00;');
      console.log('%câ”‚  Hint: The GitHub commits tell a story.    â”‚', 'color: #00aa00;');
      console.log('%câ”‚  Search for "3AM" in the commit history.   â”‚', 'color: #00aa00;');
      console.log('%câ”‚                                             â”‚', 'color: #00aa00;');
      console.log('%câ”‚  Next clue: What\'s in /terminal?           â”‚', 'color: #00aa00;');
      console.log('%câ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜', 'color: #00aa00;');
      console.log('');
      console.log('%cAchievement Progress: SOURCE_DIVER [1/3]', 'color: #ffaa00;');
      console.log('%c"Read the comments, check the console, find the turtle."', 'color: #508050;');
      
      // Hidden: Type "gunter" in console to reveal more
      window.gunter = function() {
        console.log('%cğŸ® ACHIEVEMENT UNLOCKED: CONSOLE_COWBOY', 'color: #00ff00; font-size: 16px;');
        console.log('%c"You typed the magic word."', 'color: #508050;');
        console.log('');
        console.log('%cReal talk: This whole project was built with AI.', 'color: #00ff00;');
        console.log('%c18,000+ lines of UdonSharp. 365+ Claude conversations.', 'color: #00ff00;');
        console.log('%cThe story is at: basementos.com/story', 'color: #00ff00;');
        console.log('');
        console.log('%cNow go visit the actual basement:', 'color: #00aa00;');
        console.log('%chttps://vrchat.com/home/launch?worldId=wrld_7302897c-be0f-4037-ac67-76f0ea065c2b', 'color: #00ffff;');
        return 'ğŸ¢';
      };
    }

    // Run on DOM ready
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  })();
</script>